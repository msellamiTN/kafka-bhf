<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 600">
  <defs>
    <linearGradient id="sagaGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="cqrsGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#06b6d4;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0891b2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="eventGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#d97706;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="950" height="600" fill="#f8fafc"/>
  
  <!-- Title -->
  <text x="475" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#1e293b">
    Patterns Microservices avec Apache Kafka
  </text>
  
  <!-- Pattern 1: Saga Pattern -->
  <g transform="translate(20, 60)">
    <rect x="0" y="0" width="290" height="240" rx="12" fill="#faf5ff" stroke="#e9d5ff" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="290" height="40" rx="12" fill="url(#sagaGrad)"/>
    <text x="145" y="27" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
      ğŸ”„ SAGA Pattern
    </text>
    
    <!-- Saga flow -->
    <g transform="translate(20, 55)">
      <rect x="0" y="0" width="70" height="35" rx="4" fill="#ddd6fe"/>
      <text x="35" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Order</text>
      
      <line x1="75" y1="17" x2="90" y2="17" stroke="#7c3aed" stroke-width="2"/>
      <polygon points="90,13 98,17 90,21" fill="#7c3aed"/>
      
      <rect x="100" y="0" width="70" height="35" rx="4" fill="#ddd6fe"/>
      <text x="135" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Payment</text>
      
      <line x1="175" y1="17" x2="190" y2="17" stroke="#7c3aed" stroke-width="2"/>
      <polygon points="190,13 198,17 190,21" fill="#7c3aed"/>
      
      <rect x="200" y="0" width="70" height="35" rx="4" fill="#ddd6fe"/>
      <text x="235" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#5b21b6">Inventory</text>
    </g>
    
    <!-- Kafka in middle -->
    <rect x="80" y="110" width="130" height="35" rx="6" fill="#1e1b4b"/>
    <text x="145" y="132" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">âš¡ Kafka Events</text>
    
    <!-- Description -->
    <text x="145" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#5b21b6">Transactions distribuÃ©es</text>
    <text x="145" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#5b21b6">avec compensation</text>
    
    <!-- Use case -->
    <rect x="20" y="195" width="250" height="30" rx="4" fill="#ede9fe"/>
    <text x="145" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6b21a8">ğŸ“¦ E-commerce: Commande â†’ Paiement â†’ Stock</text>
  </g>
  
  <!-- Pattern 2: CQRS -->
  <g transform="translate(330, 60)">
    <rect x="0" y="0" width="290" height="240" rx="12" fill="#ecfeff" stroke="#a5f3fc" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="290" height="40" rx="12" fill="url(#cqrsGrad)"/>
    <text x="145" y="27" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
      ğŸ“Š CQRS Pattern
    </text>
    
    <!-- CQRS flow -->
    <g transform="translate(20, 55)">
      <!-- Write side -->
      <rect x="0" y="0" width="100" height="45" rx="4" fill="#a5f3fc"/>
      <text x="50" y="18" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#0e7490">âœï¸ Write Model</text>
      <text x="50" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#0e7490">(Commands)</text>
      
      <!-- Read side -->
      <rect x="150" y="0" width="100" height="45" rx="4" fill="#a5f3fc"/>
      <text x="200" y="18" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#0e7490">ğŸ‘ï¸ Read Model</text>
      <text x="200" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#0e7490">(Queries)</text>
    </g>
    
    <!-- Kafka in middle -->
    <rect x="80" y="110" width="130" height="35" rx="6" fill="#1e1b4b"/>
    <text x="145" y="132" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">âš¡ Kafka Sync</text>
    
    <!-- Description -->
    <text x="145" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0e7490">SÃ©paration lecture/Ã©criture</text>
    <text x="145" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0e7490">pour haute performance</text>
    
    <!-- Use case -->
    <rect x="20" y="195" width="250" height="30" rx="4" fill="#cffafe"/>
    <text x="145" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#0e7490">ğŸ¦ Banking: Transactions â†’ Reporting</text>
  </g>
  
  <!-- Pattern 3: Event Sourcing -->
  <g transform="translate(640, 60)">
    <rect x="0" y="0" width="290" height="240" rx="12" fill="#fffbeb" stroke="#fde68a" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="290" height="40" rx="12" fill="url(#eventGrad)"/>
    <text x="145" y="27" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
      ğŸ“œ Event Sourcing
    </text>
    
    <!-- Event log -->
    <g transform="translate(20, 55)">
      <rect x="0" y="0" width="250" height="25" rx="3" fill="#fef3c7"/>
      <text x="125" y="17" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#92400e">OrderCreated â†’ OrderPaid â†’ OrderShipped</text>
      
      <rect x="0" y="30" width="250" height="25" rx="3" fill="#fde68a"/>
      <text x="125" y="47" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#92400e">Ã‰tat reconstruit depuis les Ã©vÃ©nements</text>
    </g>
    
    <!-- Kafka in middle -->
    <rect x="80" y="110" width="130" height="35" rx="6" fill="#1e1b4b"/>
    <text x="145" y="132" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">âš¡ Kafka Log</text>
    
    <!-- Description -->
    <text x="145" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#92400e">Historique complet</text>
    <text x="145" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#92400e">et audit trail</text>
    
    <!-- Use case -->
    <rect x="20" y="195" width="250" height="30" rx="4" fill="#fef3c7"/>
    <text x="145" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#92400e">ğŸ¥ Healthcare: Dossier patient Ã©volutif</text>
  </g>
  
  <!-- Pattern 4: CDC (Change Data Capture) -->
  <g transform="translate(20, 320)">
    <rect x="0" y="0" width="290" height="240" rx="12" fill="#fef2f2" stroke="#fecaca" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="290" height="40" rx="12" fill="#ef4444"/>
    <text x="145" y="27" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
      ğŸ”„ CDC Pattern
    </text>
    
    <!-- CDC flow -->
    <g transform="translate(20, 55)">
      <rect x="0" y="0" width="80" height="40" rx="4" fill="#fecaca"/>
      <text x="40" y="18" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#991b1b">ğŸ—ƒï¸ Database</text>
      <text x="40" y="32" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#991b1b">PostgreSQL</text>
      
      <line x1="85" y1="20" x2="115" y2="20" stroke="#ef4444" stroke-width="2"/>
      <polygon points="115,16 123,20 115,24" fill="#ef4444"/>
      
      <rect x="125" y="0" width="60" height="40" rx="4" fill="#fecaca"/>
      <text x="155" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#991b1b">Debezium</text>
      
      <line x1="190" y1="20" x2="220" y2="20" stroke="#ef4444" stroke-width="2"/>
      <polygon points="220,16 228,20 220,24" fill="#ef4444"/>
      
      <rect x="230" y="0" width="30" height="40" rx="4" fill="#1e1b4b"/>
      <text x="245" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">âš¡</text>
    </g>
    
    <!-- Description -->
    <text x="145" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#991b1b">Capture des changements DB</text>
    <text x="145" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#991b1b">en temps rÃ©el vers Kafka</text>
    
    <!-- Benefits -->
    <g transform="translate(30, 155)">
      <text x="0" y="0" font-family="Arial, sans-serif" font-size="9" fill="#7f1d1d">âœ… Sync multi-DB sans couplage</text>
      <text x="0" y="15" font-family="Arial, sans-serif" font-size="9" fill="#7f1d1d">âœ… Migration vers microservices</text>
      <text x="0" y="30" font-family="Arial, sans-serif" font-size="9" fill="#7f1d1d">âœ… Data Lake en temps rÃ©el</text>
    </g>
    
    <!-- Use case -->
    <rect x="20" y="195" width="250" height="30" rx="4" fill="#fee2e2"/>
    <text x="145" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#991b1b">ğŸ¢ Legacy: Strangler Fig Pattern</text>
  </g>
  
  <!-- Pattern 5: Stream Processing -->
  <g transform="translate(330, 320)">
    <rect x="0" y="0" width="290" height="240" rx="12" fill="#f0fdf4" stroke="#bbf7d0" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="290" height="40" rx="12" fill="#22c55e"/>
    <text x="145" y="27" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
      ğŸŒŠ Stream Processing
    </text>
    
    <!-- Stream flow -->
    <g transform="translate(20, 55)">
      <rect x="0" y="0" width="60" height="35" rx="4" fill="#bbf7d0"/>
      <text x="30" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#166534">Input</text>
      
      <line x1="65" y1="17" x2="85" y2="17" stroke="#22c55e" stroke-width="2"/>
      <polygon points="85,13 93,17 85,21" fill="#22c55e"/>
      
      <rect x="95" y="0" width="80" height="35" rx="4" fill="#1e1b4b"/>
      <text x="135" y="15" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">Kafka Streams</text>
      <text x="135" y="28" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">Filter/Map/Join</text>
      
      <line x1="180" y1="17" x2="200" y2="17" stroke="#22c55e" stroke-width="2"/>
      <polygon points="200,13 208,17 200,21" fill="#22c55e"/>
      
      <rect x="210" y="0" width="60" height="35" rx="4" fill="#bbf7d0"/>
      <text x="240" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#166534">Output</text>
    </g>
    
    <!-- Description -->
    <text x="145" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#166534">Traitement temps rÃ©el</text>
    <text x="145" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#166534">avec exactement-once</text>
    
    <!-- Benefits -->
    <g transform="translate(30, 155)">
      <text x="0" y="0" font-family="Arial, sans-serif" font-size="9" fill="#166534">âœ… AgrÃ©gations temps rÃ©el</text>
      <text x="0" y="15" font-family="Arial, sans-serif" font-size="9" fill="#166534">âœ… Jointures entre streams</text>
      <text x="0" y="30" font-family="Arial, sans-serif" font-size="9" fill="#166534">âœ… Windowing (fenÃªtres temps)</text>
    </g>
    
    <!-- Use case -->
    <rect x="20" y="195" width="250" height="30" rx="4" fill="#dcfce7"/>
    <text x="145" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#166534">ğŸ“ˆ Trading: Calcul de prix en temps rÃ©el</text>
  </g>
  
  <!-- Pattern 6: Dead Letter Queue -->
  <g transform="translate(640, 320)">
    <rect x="0" y="0" width="290" height="240" rx="12" fill="#fdf4ff" stroke="#f5d0fe" stroke-width="2" filter="url(#shadow)"/>
    <rect x="0" y="0" width="290" height="40" rx="12" fill="#a855f7"/>
    <text x="145" y="27" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
      ğŸ’€ Dead Letter Topic
    </text>
    
    <!-- DLT flow -->
    <g transform="translate(20, 55)">
      <rect x="0" y="0" width="70" height="35" rx="4" fill="#f5d0fe"/>
      <text x="35" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#86198f">Main Topic</text>
      
      <line x1="75" y1="17" x2="95" y2="17" stroke="#a855f7" stroke-width="2"/>
      <polygon points="95,13 103,17 95,21" fill="#a855f7"/>
      
      <rect x="105" y="0" width="70" height="35" rx="4" fill="#f5d0fe"/>
      <text x="140" y="22" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#86198f">Consumer</text>
      
      <!-- Error path -->
      <line x1="140" y1="40" x2="140" y2="55" stroke="#dc2626" stroke-width="2" stroke-dasharray="4"/>
      <polygon points="136,55 140,63 144,55" fill="#dc2626"/>
      
      <rect x="105" y="65" width="70" height="25" rx="4" fill="#fecaca"/>
      <text x="140" y="82" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#991b1b">âŒ Error</text>
      
      <!-- DLT -->
      <line x1="180" y1="77" x2="200" y2="77" stroke="#dc2626" stroke-width="2"/>
      <polygon points="200,73 208,77 200,81" fill="#dc2626"/>
      
      <rect x="210" y="65" width="60" height="25" rx="4" fill="#1e1b4b"/>
      <text x="240" y="82" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">ğŸ’€ DLT</text>
    </g>
    
    <!-- Description -->
    <text x="145" y="165" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#86198f">Gestion robuste des erreurs</text>
    <text x="145" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#86198f">avec retry et quarantaine</text>
    
    <!-- Use case -->
    <rect x="20" y="195" width="250" height="30" rx="4" fill="#fae8ff"/>
    <text x="145" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#86198f">ğŸ”’ Finance: Transactions Ã©chouÃ©es</text>
  </g>
</svg>
